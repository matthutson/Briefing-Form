<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Content Update Form</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #172B4D;
        }
        input[type="text"],
        input[type="date"] {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid #DFE1E6;
            border-radius: 3px;
            font-size: 1rem;
        }
        .editor {
            border: 2px solid #DFE1E6;
            border-radius: 3px;
            padding: 0.5rem;
            min-height: 100px;
            background: white;
        }
        .editor-toolbar {
            padding: 0.5rem;
            border: 2px solid #DFE1E6;
            border-bottom: none;
            border-radius: 3px 3px 0 0;
            background: #f4f5f7;
        }
        .editor-toolbar button {
            margin-right: 0.5rem;
            padding: 0.25rem 0.5rem;
            background: white;
            border: 1px solid #DFE1E6;
            border-radius: 3px;
            cursor: pointer;
        }
        .editor-content {
            border: 2px solid #DFE1E6;
            border-top: none;
            border-radius: 0 0 3px 3px;
            padding: 0.5rem;
            min-height: 100px;
        }
        .submit-btn {
            background: #0052CC;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 3px;
            font-size: 1rem;
            cursor: pointer;
        }
        .submit-btn:hover {
            background: #0747A6;
        }
        .file-list {
            margin-top: 1rem;
        }
        .file-item {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            background: #f4f5f7;
            border-radius: 3px;
            margin-bottom: 0.5rem;
        }
        .file-item button {
            margin-left: auto;
            color: #DE350B;
            background: none;
            border: none;
            cursor: pointer;
        }
        [contenteditable]:focus {
            outline: none;
        }
    </style>
</head>
<body>
    <h1>Create Web Content Update</h1>
    
    <form id="webContentForm">
        <div class="form-group">
            <label for="projectName">Project Name*</label>
            <input type="text" id="projectName" name="projectName" required>
        </div>
        
        <div class="form-group">
            <label>A brief description of what's required*</label>
            <div class="editor-toolbar">
                <button type="button" onclick="formatDoc('bold')">B</button>
                <button type="button" onclick="formatDoc('italic')">I</button>
                <button type="button" onclick="formatDoc('insertunorderedlist')">• List</button>
                <button type="button" onclick="formatDoc('createlink')">Link</button>
            </div>
            <div id="description" class="editor-content" contenteditable="true"></div>
        </div>
        
        <div class="form-group">
            <label for="name">Name*</label>
            <input type="text" id="name" name="name" required>
        </div>
        
        <div class="form-group">
            <label for="dueDate">When do you need this live?*</label>
            <input type="date" id="dueDate" name="dueDate" required>
        </div>
        
        <div class="form-group">
            <label>Please list each page name and URL of the pages you're briefing*</label>
            <div class="editor-toolbar">
                <button type="button" onclick="formatDoc('bold', 'pages')">B</button>
                <button type="button" onclick="formatDoc('italic', 'pages')">I</button>
                <button type="button" onclick="formatDoc('insertunorderedlist', 'pages')">• List</button>
                <button type="button" onclick="formatDoc('createlink', 'pages')">Link</button>
            </div>
            <div id="pages" class="editor-content" contenteditable="true"></div>
        </div>
        
        <div class="form-group">
            <label>Files and Images</label>
            <input type="file" id="fileInput" multiple>
            <div id="fileList" class="file-list"></div>
        </div>
        
        <button type="submit" class="submit-btn">Create Issue</button>
    </form>

    <script>
        function formatDoc(cmd, editorId = 'description') {
            if (cmd === 'createlink') {
                const url = prompt('Enter URL:');
                if (url) document.execCommand(cmd, false, url);
            } else {
                document.execCommand(cmd, false, null);
            }
            document.getElementById(editorId).focus();
        }

        // File handling
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const files = new Map();

        fileInput.addEventListener('change', (e) => {
            for (const file of e.target.files) {
                const fileId = Date.now() + '-' + file.name;
                files.set(fileId, file);
                addFileToList(fileId, file.name);
            }
            fileInput.value = ''; // Reset input
        });

        function addFileToList(fileId, fileName) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
                ${fileName}
                <button type="button" onclick="removeFile('${fileId}')">✕</button>
            `;
            fileList.appendChild(fileItem);
        }

        function removeFile(fileId) {
            files.delete(fileId);
            const fileItems = fileList.getElementsByClassName('file-item');
            for (const item of fileItems) {
                if (item.textContent.includes(fileId)) {
                    item.remove();
                    break;
                }
            }
        }

        // Form submission
        document.getElementById('webContentForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData();
            
            // Add text fields
            formData.append('projectName', document.getElementById('projectName').value);
            formData.append('description', document.getElementById('description').innerHTML);
            formData.append('name', document.getElementById('name').value);
            formData.append('dueDate', document.getElementById('dueDate').value);
            formData.append('pages', document.getElementById('pages').innerHTML);

            // Add files
            files.forEach((file, fileId) => {
                formData.append('files', file, file.name);
            });

            try {
                const response = await fetch('https://n8n-container-service.5ndtj2s2t8qdr.eu-west-2.cs.amazonlightsail.com/webhook-test/9c5d58f8-73a1-45c7-9360-6cedf7e94676', {
                    method: 'POST',
                    body: formData // FormData automatically sets the correct content-type
                });

                if (!response.ok) {
                    throw new Error('Failed to create issue');
                }

                alert('Issue created successfully!');
                document.getElementById('webContentForm').reset();
                document.getElementById('description').innerHTML = '';
                document.getElementById('pages').innerHTML = '';
                fileList.innerHTML = '';
                files.clear();

            } catch (error) {
                alert('Error creating issue: ' + error.message);
            }
        });
    </script>
</body>
</html>
